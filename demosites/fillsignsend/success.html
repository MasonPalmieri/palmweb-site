<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FSS — Completed</title>
  <link rel="stylesheet" href="assets/app.css" />
</head>

<body class="app light">
  <header class="topbar">
    <div class="brand">
      <div class="logo">FSS</div>
      <div>
        <div class="title">Envelope Completed</div>
        <div class="sub">Signed PDF is ready to view and download.</div>
      </div>
    </div>

    <nav class="navlinks">
      <a href="dashboard.html">Dashboard</a>
      <a href="create.html">Create</a>
      <a href="audit.html">Audit</a>
      <a href="../../demos.html" id="logoutBtn">Logout</a>
    </nav>
  </header>

  <main class="page">
    <div class="shell">
      <section class="panel">
        <div class="panelHead">
          <div>
            <h2 style="margin:0;">✅ Document Completed</h2>
            <p class="muted" style="margin:6px 0 0;">
              The signed PDF below was generated directly in-browser using the real template file.
            </p>
          </div>

          <div class="actions">
            <a class="btn secondary" href="dashboard.html">Back to Dashboard</a>
            <a class="btn primary" id="downloadBtn" download="signed-document.pdf" href="#">Download Signed PDF</a>
          </div>
        </div>

        <div class="divider"></div>

        <div id="errorBox" style="display:none; padding:14px; border-radius:14px; border:1px solid #fecaca; background:#fee2e2; color:#7f1d1d; font-weight:900;">
          No signed PDF was found. Please complete signing again.
        </div>

        <div class="pdfWrap">
          <iframe id="signedFrame" title="Signed PDF Preview"></iframe>
        </div>

        <p class="tiny muted" style="margin-top:10px;">
          In a production system this PDF would be stored in a database and a secure link would be emailed to both parties.
        </p>
      </section>
    </div>
  </main>

  <script src="assets/app.js"></script>
  <script>
    FSS.guard();

    const base64 = localStorage.getItem("fss_signed");
    const frame = document.getElementById("signedFrame");
    const downloadBtn = document.getElementById("downloadBtn");
    const errorBox = document.getElementById("errorBox");

    if(!base64){
      errorBox.style.display = "block";
      frame.style.display = "none";
      downloadBtn.style.display = "none";
    } else {
      const pdfData = `data:application/pdf;base64,${base64}`;
      frame.src = pdfData;
      downloadBtn.href = pdfData;
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
      FSS.logout();
    });
  </script>

  <style>
    .pdfWrap{
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
      box-shadow: 0 18px 40px rgba(15,23,42,.08);
    }
    iframe{
      width: 100%;
      height: 920px;
      border: 0;
      background:#fff;
    }
    @media(max-width: 980px){
      iframe{ height: 650px; }
    }
  </style>
</body>
</html>
